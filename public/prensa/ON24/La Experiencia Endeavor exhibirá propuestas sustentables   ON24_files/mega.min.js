var jaMegaMenuMoo=new Class({initialize:function(c,b){this.options=$extend({slide:true,duration:300,fading:false,bgopacity:0.9,delayHide:500,direction:"down",action:"mouseenter",hidestyle:"normal"},b||{});if(!this.options.slide&&!this.options.fading){this.options.delayHide=10}this.menu=c;this.childopen=new Array();this.imageloaded=false;this.loaded=false;this.start()},start:function(){if(this.loaded){return}this.menu=$(this.menu);var b=this.menu.getElements("img");if(b&&b.length&&!this.imageloaded){var d=[];b.each(function(e){d.push(e.src)});if(d.length){new Asset.images(d,{onComplete:function(){this.start()}.bind(this)});this.imageloaded=true;this.start.delay(3000,this);return}}this.loaded=true;p=this.menu;while(p=p.getParent()){if(p.hasClass("main")||p.hasClass("wrap")){this.wrapper=p;break}}this.items=this.menu.getElements("li.mega");this.items.each(function(e){if((a=e.getElement("a.mega"))&&this.isChild(a,e)){e.a=a}else{e.a=null}e._parent=this.getParent(e);if((childcontent=e.getElement(".childcontent"))&&this.isChild(childcontent,e)){e.childcontent=childcontent;e.childcontent_inner=e.childcontent.getElement(".childcontent-inner-wrap");var g=e.childcontent_inner.getCoordinates();e._w=e.getElement(".childcontent-inner").offsetWidth;e._h=e.getElement(".childcontent-inner").offsetHeight;e.level0=e.getParent().hasClass("level0");if(e._w){e.childcontent.setStyles({width:e._w+10,height:e._h});e.childcontent_inner.setStyles({width:e._w})}e.childcontent_inner1=e.childcontent.getElement(".childcontent-inner");e.childcontent_inner1.ol=false;if(e.childcontent_inner1.getStyle("overflow")=="auto"||e.childcontent_inner1.getStyle("overflow")=="scroll"){e.childcontent_inner1.ol=true;if(window.ie6||window.ie7){e.childcontent_inner1.setStyle("position","relative")}if(window.ie6){e.childcontent_inner1.setStyle("height",e.childcontent_inner1.getStyle("max-height")||400)}}if(this.options.direction=="up"){if(e.level0){e.childcontent.setStyle("top",-e.childcontent.offsetHeight)}else{e.childcontent.setStyle("bottom",0)}}}else{e.childcontent=null}if(e.childcontent&&this.options.bgopacity){var f=new Element("div",{"class":"childcontent-bg"});f.injectTop(e.childcontent_inner);f.setStyles({width:"100%",height:e._h,opacity:this.options.bgopacity,position:"absolute",top:0,left:0,"z-index":1});if(e.childcontent.getStyle("background")){f.setStyle("background",e.childcontent.getStyle("background"))}if(e.childcontent.getStyle("background-image")){f.setStyle("background-image",e.childcontent.getStyle("background-image"))}if(e.childcontent.getStyle("background-repeat")){f.setStyle("background-repeat",e.childcontent.getStyle("background-repeat"))}if(e.childcontent.getStyle("background-color")){f.setStyle("background-color",e.childcontent.getStyle("background-color"))}e.childcontent.setStyle("background","none");e.childcontent_inner.setStyles({position:"relative","z-index":2})}if(e.childcontent&&(this.options.slide||this.options.fading)){e.childcontent.setStyles({left:"auto"});if(e.childcontent.hasClass("right")){e.childcontent.setStyle("right",0)}if(this.options.slide){e.childcontent.setStyles({left:"auto",overflow:"hidden"});if(e.level0){if(this.options.direction=="up"){e.childcontent_inner.setStyle("bottom",-e._h-20)}else{e.childcontent_inner.setStyle("margin-top",-e._h-20)}}else{e.childcontent_inner.setStyle("margin-left",-e._w-20)}}if(this.options.fading){e.childcontent_inner.setStyle("opacity",0)}e.fx=new Fx.Morph(e.childcontent_inner,{duration:this.options.duration,transition:Fx.Transitions.linear,onComplete:this.itemAnimDone.bind(this,e)});e.eff_on={};e.eff_off={};if(this.options.slide){if(e.level0){if(this.options.direction=="up"){e.eff_on.bottom=0;e.eff_off.bottom=-e._h}else{e.eff_on["margin-top"]=0;e.eff_off["margin-top"]=-e._h}}else{e.eff_on["margin-left"]=0;e.eff_off["margin-left"]=-e._w}}if(this.options.fading){e.eff_on.opacity=1;e.eff_off.opacity=0}}if(this.options.action=="click"&&e.childcontent){e.addEvent("click",function(j){var h=new Event(j);if(e.hasClass("group")){return}if($("ja-menu-button")&&$("ja-menu-button").getStyle("z-index")>=3){return}if(e.childcontent){if(e.status=="open"){if(this.cursorIn(e,h)){this.itemHide(e)}else{this.itemHideOthers(e)}}else{this.itemShow(e)}}else{if(e.a){location.href=e.a.href}}h.stopPropagation()}.bind(this))}if(e.timer==undefined){e.timer=null}if(this.options.action=="mouseover"||this.options.action=="mouseenter"){e.addEvent("mouseenter",function(h){if(e.hasClass("group")){return}if($("ja-menu-button")&&$("ja-menu-button").getStyle("z-index")>=3){return}$clear(e.timer);this.itemShow(e);if(!h.stopped){h.stopPropagation();h.stopped=true}}.bind(this));e.addEvent("mouseleave",function(h){if(e.hasClass("group")){return}if($("ja-menu-button")&&$("ja-menu-button").getStyle("z-index")>=3){return}$clear(e.timer);if(e.childcontent){e.timer=this.itemHide.delay(this.options.delayHide,this,[e,h])}else{this.itemHide(e,h)}if(!h.stopped){h.stopPropagation();h.stopped=true}}.bind(this));if(e.a&&e.childcontent){e.clickable=false;e.a.addEvent("click",function(h){if(!e.clickable){new Event(h).stop()}}.bind(this))}e.addEvent("click",function(h){new Event(h).stopPropagation()})}if(e.a&&!e.childcontent){e.a.addEvent("click",function(j){this.itemHideOthers(null);this.menu.getElements(".active").removeClass("active");var h=e;while(h){h.addClass("active");h.a.addClass("active");h=h._parent}new Event(j).stopPropagation()}.bind(this))}if(e.childcontent){this.positionSubmenu(e)}},this);var c=$("ja-wrapper");if(!c){c=document.body}c.addEvent("click",function(f){this.itemHideOthers(null)}.bind(this));if(this.options.slide||this.options.fading){this.menu.getElements(".childcontent").setStyle("display","none")}},getParent:function(b){var c=b;while((c=c.getParent())){if(this.items.contains(c)&&!c.hasClass("group")){return c}if(!c||c==this.menu){return null}}},cursorIn:function(b,c){if(!b||!c){return false}var e=$merge(b.getPosition(),{w:b.offsetWidth,h:b.offsetHeight});var d={x:c.page.x,y:c.page.y};if(d.x>e.x&&d.x<e.x+b.offsetWidth&&d.y>e.y&&d.y<e.y+b.offsetHeight){return true}return false},isChild:function(c,b){return!!b.getChildren().contains(c)},itemOver:function(b){if(b.hasClass("haschild")){b.removeClass("haschild").addClass("haschild-over")}b.addClass("over");if(b.a){b.a.addClass("over")}},itemOut:function(b){if(b.hasClass("haschild-over")){b.removeClass("haschild-over").addClass("haschild")}b.removeClass("over");if(b.a){b.a.removeClass("over")}},itemShow:function(b){clearTimeout(b.timer);if(b.status=="open"){return}this.itemOver(b);b.status="open";this.enableclick.delay(100,this,b);this.childopen.push(b);this.itemHideOthers(b);if(b.childcontent){this.positionSubmenu(b);b.childcontent.setStyle("display","block")}if(!$defined(b.fx)||!$defined(b.childcontent)){return}b.childcontent.setStyles({overflow:"hidden"});if(b.childcontent_inner1.ol){b.childcontent_inner1.setStyles({overflow:"hidden"})}b.fx.cancel();b.fx.start(b.eff_on)},itemHide:function(b,d){if(d&&d.page){if(this.cursorIn(b,d)||this.cursorIn(b.childcontent,d)){return}var c=b._parent;if(c&&!this.cursorIn(c,d)&&!this.cursorIn(c.childcontent,d)){c.fireEvent("mouseleave",d)}}clearTimeout(b.timer);this.itemOut(b);b.status="close";this.childopen.erase(b);if(!$defined(b.fx)||!$defined(b.childcontent)){return}if(b.childcontent.getStyle("opacity")==0){return}b.childcontent.setStyles({overflow:"hidden"});if(b.childcontent_inner1.ol){b.childcontent_inner1.setStyles({overflow:"hidden"})}b.fx.cancel();switch(this.options.hidestyle){case"fast":b.fx.options.duration=100;b.fx.start(Object.merge(b.eff_off,{opacity:0}));break;case"fastwhenshow":if(!d){b.fx.start(Object.merge(b.eff_off,{opacity:0}))}else{b.fx.start(b.eff_off)}break;case"normal":default:b.fx.start(b.eff_off);break}},itemAnimDone:function(b){if(b.status=="close"){if(this.options.hidestyle.test(/fast/)){b.fx.options.duration=this.options.duration;if(!this.options.fading){b.childcontent_inner.setStyle("opacity",1)}}b.childcontent.setStyles({display:"none"});this.disableclick.delay(100,this,b)}if(b.status=="open"){b.childcontent.setStyles({overflow:""});if(b.childcontent_inner1.ol){b.childcontent_inner1.setStyles({"overflow-y":"auto"})}b.childcontent_inner.setStyle("opacity",1);b.childcontent.setStyles({display:"block"})}},itemHideOthers:function(d){var b=null;if(d&&!d.childcontent){b={}}var c=this.childopen;c.each(function(e){if(e&&typeof(e.status)!="undefined"&&(!d||(e!=d&&!e.hasChild(d)))){this.itemHide(e,b)}},this)},enableclick:function(b){if(b.a&&b.childcontent){b.clickable=true}},disableclick:function(b){if(b.a&&b.childcontent){b.clickable=false}},positionSubmenu:function(k){if(k.level0){if(!window.isRTL){var j=k.getCoordinates();var c=k.childcontent.getCoordinates();if(!c.width){k.childcontent.setStyle("display","block");c=k.childcontent.getCoordinates();k.childcontent.setStyle("display","none")}var g=0;var e=j.left;var b=e+c.width;if(this.wrapper){var m=this.wrapper.getCoordinates();e=e-m.left;b=m.right-b+10}else{b=window.getWidth()-b+10}if(e<0||e+b<0){g=-e}else{if(b<0){g=b}}if(g!=0){k.childcontent.setStyle("margin-left",g-10)}}else{var j=k.getCoordinates();var c=k.childcontent.getCoordinates();if(!c.width){k.childcontent.setStyle("display","block");c=k.childcontent.getCoordinates();k.childcontent.setStyle("display","none")}var d=0;var b=j.right;var e=b-c.width;if(this.wrapper){var m=this.wrapper.getCoordinates();e=e-m.left;b=m.right-b+10}else{b=window.getWidth()-b+10}if(b<0||e+b<0){d=-b}else{if(e<0){d=e}}if(d!=0){k.childcontent.setStyle("margin-right",d)}}}else{if(window.isRTL){var h="left";if(k.view_direction!=undefined){h=k.view_direction}var j=k.getCoordinates();var c=k.childcontent.getCoordinates();if(!c.width){k.childcontent.setStyle("display","block");c=k.childcontent.getCoordinates();k.childcontent.setStyle("display","none")}if(h=="right"){var b=j.right+c.width;if(this.wrapper){var m=this.wrapper.getCoordinates();b=m.right-b+10}else{b=window.getWidth()-b+10}if(b<0){k.childcontent.setStyle("margin-right",j.width);var f=k.childcontent.getElements("li");for(i=0;i<f.length;i++){f[i].view_direction="left"}}else{k.childcontent.setStyle("margin-right",-c.width+20)}}else{var e=j.left-c.width;if(this.wrapper){var m=this.wrapper.getCoordinates();e=e-m.left+10}else{e=e+10}if(e<0){k.childcontent.setStyle("margin-right",-c.width+20);var f=k.childcontent.getElements("li");for(i=0;i<f.length;i++){f[i].view_direction="right"}}else{k.childcontent.setStyle("margin-right",j.width);var f=k.childcontent.getElements("li");for(i=0;i<f.length;i++){f[i].view_direction="left"}}}}else{var h="right";if(k.view_direction!=undefined){h=k.view_direction}var j=k.getCoordinates();var c=k.childcontent.getCoordinates();if(!c.width){k.childcontent.setStyle("display","block");c=k.childcontent.getCoordinates();k.childcontent.setStyle("display","none")}if(h=="right"){var b=j.right+c.width;if(this.wrapper){var m=this.wrapper.getCoordinates();b=m.right-b+10}else{b=window.getWidth()-b+10}if(b<0){k.childcontent.setStyle("margin-left",-c.width+20);var f=k.childcontent.getElements("li");for(i=0;i<f.length;i++){f[i].view_direction="left"}}}else{var e=j.left-c.width;if(this.wrapper){var m=this.wrapper.getCoordinates();e=e-m.left+10}else{e=e+10}if(e<0){var f=k.childcontent.getElements("li");for(i=0;i<f.length;i++){f[i].view_direction="right"}}else{k.childcontent.setStyle("margin-left",-j.width-20)}}}}}});